<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸Šä¼ æ’ä»¶ - InnoFlow</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/layout.css">
    <link rel="stylesheet" href="../css/animation.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        .upload-form-container {
            max-width: 900px;
            margin: 0 auto;
        }
        .upload-section {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .upload-section h2 {
            margin: 0 0 20px 0;
            font-size: 20px;
            color: var(--primary-color);
        }
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .form-group-full {
            margin-bottom: 20px;
        }
        .form-group-full label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-primary);
        }
        .form-group-full input,
        .form-group-full textarea,
        .form-group-full select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
        }
        .form-group-full textarea {
            min-height: 100px;
            resize: vertical;
        }
        .form-group-full small {
            display: block;
            margin-top: 4px;
            color: var(--text-secondary);
            font-size: 12px;
        }
        .file-upload-area {
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .file-upload-area:hover {
            border-color: var(--primary-color);
            background: #f0f4ff;
        }
        .file-upload-area.dragover {
            border-color: var(--primary-color);
            background: #f0f4ff;
        }
        .file-upload-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }
        .file-list {
            margin-top: 16px;
        }
        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 6px;
            margin-bottom: 8px;
        }
        .file-item-name {
            flex: 1;
            margin-right: 12px;
        }
        .file-item-remove {
            color: #dc3545;
            cursor: pointer;
            font-weight: bold;
        }
        .price-input-group {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .price-input-group input {
            flex: 1;
        }
        .price-input-group span {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-secondary);
        }
        .price-reason-box {
            margin-top: 12px;
            padding: 12px;
            background: #fffbf0;
            border-left: 3px solid #ffc107;
            border-radius: 4px;
        }
        .price-reason-box h4 {
            margin: 0 0 8px 0;
            font-size: 14px;
        }
        .price-reason-box textarea {
            width: 100%;
            min-height: 80px;
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 14px;
            font-family: inherit;
        }
        .feature-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }
        .feature-tag {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: #e7f3ff;
            border-radius: 16px;
            font-size: 14px;
        }
        .feature-tag-remove {
            cursor: pointer;
            color: #dc3545;
            font-weight: bold;
        }
        .feature-input-group {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }
        .feature-input-group input {
            flex: 1;
        }
        .submit-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 32px;
            padding-top: 24px;
            border-top: 1px solid var(--border-color);
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-left">
            <img src="../assets/logo.svg" alt="InnoFlow" class="nav-logo">
            <span class="nav-title">InnoFlow - ä¸Šä¼ æ’ä»¶</span>
        </div>
        <div class="nav-right">
            <button class="btn-secondary" onclick="window.location.href='../toolstore.html'">è¿”å›å•†åº—</button>
        </div>
    </nav>

    <div class="container">
        <div class="page-header">
            <h1>ä¸Šä¼ æ’ä»¶</h1>
            <p class="page-subtitle">åˆ†äº«æ‚¨çš„åˆ›æ–°å·¥å…·ï¼Œè®©æ›´å¤šå›¢é˜Ÿå—ç›Š</p>
        </div>

        <form id="uploadPluginForm" class="upload-form-container">
            <!-- åŸºæœ¬ä¿¡æ¯ -->
            <div class="upload-section">
                <h2>ğŸ“‹ åŸºæœ¬ä¿¡æ¯</h2>

                <div class="form-group-full">
                    <label for="pluginName">æ’ä»¶åç§° <span style="color: #dc3545;">*</span></label>
                    <input type="text" id="pluginName" placeholder="ä¾‹å¦‚ï¼šAIä»£ç å®¡æŸ¥å·¥å…·" required>
                    <small>ç®€æ´æ˜äº†åœ°æè¿°æ‚¨çš„æ’ä»¶åŠŸèƒ½</small>
                </div>

                <div class="form-row">
                    <div class="form-group-full">
                        <label for="pluginCategory">åˆ†ç±» <span style="color: #dc3545;">*</span></label>
                        <select id="pluginCategory" required>
                            <option value="">è¯·é€‰æ‹©åˆ†ç±»</option>
                            <option value="å¼€å‘å·¥å…·">å¼€å‘å·¥å…·</option>
                            <option value="æµ‹è¯•å·¥å…·">æµ‹è¯•å·¥å…·</option>
                            <option value="ç›‘æ§å·¥å…·">ç›‘æ§å·¥å…·</option>
                            <option value="è®¾è®¡å·¥å…·">è®¾è®¡å·¥å…·</option>
                            <option value="åä½œå·¥å…·">åä½œå·¥å…·</option>
                            <option value="å…¶ä»–">å…¶ä»–</option>
                        </select>
                    </div>

                    <div class="form-group-full">
                        <label for="pluginVersion">ç‰ˆæœ¬å· <span style="color: #dc3545;">*</span></label>
                        <input type="text" id="pluginVersion" placeholder="ä¾‹å¦‚ï¼šv1.0.0" required pattern="^v?\d+\.\d+\.\d+$">
                        <small>éµå¾ªè¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒ (å¦‚: v1.0.0)</small>
                    </div>
                </div>

                <div class="form-group-full">
                    <label for="pluginDescription">æ’ä»¶æè¿° <span style="color: #dc3545;">*</span></label>
                    <textarea id="pluginDescription" placeholder="è¯¦ç»†æè¿°æ‚¨çš„æ’ä»¶åŠŸèƒ½ã€ä½¿ç”¨åœºæ™¯å’Œä¼˜åŠ¿..." required></textarea>
                    <small>å»ºè®®100-500å­—ï¼Œæ¸…æ™°è¯´æ˜æ’ä»¶çš„æ ¸å¿ƒåŠŸèƒ½</small>
                </div>

                <div class="form-group-full">
                    <label>ä¸»è¦åŠŸèƒ½ <span style="color: #dc3545;">*</span></label>
                    <div id="featureTags" class="feature-tags"></div>
                    <div class="feature-input-group">
                        <input type="text" id="featureInput" placeholder="è¾“å…¥åŠŸèƒ½ç‚¹ï¼ŒæŒ‰å›è½¦æ·»åŠ ">
                        <button type="button" class="btn-secondary" onclick="addFeature()">æ·»åŠ </button>
                    </div>
                    <small>æ·»åŠ 3-8ä¸ªä¸»è¦åŠŸèƒ½ç‚¹ï¼Œå¸®åŠ©ç”¨æˆ·å¿«é€Ÿäº†è§£æ’ä»¶</small>
                </div>
            </div>

            <!-- å®šä»·ä¿¡æ¯ -->
            <div class="upload-section">
                <h2>ğŸ’° å®šä»·ä¿¡æ¯</h2>

                <div class="form-group-full">
                    <label for="pluginPrice">å®šä»· <span style="color: #dc3545;">*</span></label>
                    <div class="price-input-group">
                        <span>Â¥</span>
                        <input type="number" id="pluginPrice" placeholder="0" min="0" step="1" required>
                        <span style="margin-left: 8px;">æˆ–</span>
                        <button type="button" class="btn-secondary" onclick="setFree()" style="margin-left: 8px;">è®¾ä¸ºå…è´¹</button>
                    </div>
                    <small>å»ºè®®å‚è€ƒå¸‚åœºåŒç±»äº§å“ä»·æ ¼ï¼Œç®¡ç†å‘˜å¯èƒ½ä¼šä¸æ‚¨åå•†å®šä»·</small>
                </div>

                <div class="price-reason-box">
                    <h4>å®šä»·ç†ç”± <span style="color: #dc3545;">*</span></h4>
                    <textarea id="priceReason" placeholder="è¯·è¯´æ˜æ‚¨çš„å®šä»·ç†ç”±ï¼Œä¾‹å¦‚ï¼šåŠŸèƒ½å¤æ‚åº¦ã€å¼€å‘æˆæœ¬ã€å¸‚åœºå‚è€ƒä»·æ ¼ç­‰ã€‚è¿™å°†å¸®åŠ©ç®¡ç†å‘˜æ›´å¥½åœ°è¯„ä¼°å®šä»·åˆç†æ€§ã€‚" required></textarea>
                    <small>è¯¦ç»†è¯´æ˜å®šä»·ä¾æ®ï¼Œæœ‰åŠ©äºå¿«é€Ÿé€šè¿‡å®¡æ ¸</small>
                </div>
            </div>

            <!-- æ–‡ä»¶ä¸Šä¼  -->
            <div class="upload-section">
                <h2>ğŸ“¦ æ–‡ä»¶ä¸Šä¼ </h2>

                <div class="form-group-full">
                    <label>æ’ä»¶æ–‡ä»¶ <span style="color: #dc3545;">*</span></label>
                    <div class="file-upload-area" id="fileUploadArea" onclick="document.getElementById('pluginFile').click()">
                        <div class="file-upload-icon">ğŸ“</div>
                        <p>ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ æ’ä»¶æ–‡ä»¶</p>
                        <p style="font-size: 12px; color: var(--text-secondary); margin-top: 8px;">æ”¯æŒ ZIPã€JSã€JSON æ ¼å¼ï¼Œæœ€å¤§ 50MB</p>
                    </div>
                    <input type="file" id="pluginFile" style="display: none;" accept=".zip,.js,.json" required>
                    <div id="fileList" class="file-list"></div>
                </div>

                <div class="form-group-full">
                    <label>æ’ä»¶æˆªå›¾ï¼ˆå¯é€‰ï¼‰</label>
                    <div class="file-upload-area" id="screenshotUploadArea" onclick="document.getElementById('screenshots').click()">
                        <div class="file-upload-icon">ğŸ–¼ï¸</div>
                        <p>ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ æˆªå›¾</p>
                        <p style="font-size: 12px; color: var(--text-secondary); margin-top: 8px;">æ”¯æŒ JPGã€PNG æ ¼å¼ï¼Œæœ€å¤š 5 å¼ </p>
                    </div>
                    <input type="file" id="screenshots" style="display: none;" accept="image/*" multiple>
                    <div id="screenshotList" class="file-list"></div>
                </div>
            </div>

            <!-- ä½¿ç”¨è¯´æ˜ -->
            <div class="upload-section">
                <h2>ğŸ“– ä½¿ç”¨è¯´æ˜</h2>

                <div class="form-group-full">
                    <label for="usageInstructions">ä½¿ç”¨è¯´æ˜ï¼ˆå¯é€‰ï¼‰</label>
                    <textarea id="usageInstructions" placeholder="æä¾›æ’ä»¶çš„å®‰è£…æ­¥éª¤ã€ä½¿ç”¨æ–¹æ³•ã€é…ç½®è¯´æ˜ç­‰..."></textarea>
                    <small>è¯¦ç»†çš„ä½¿ç”¨è¯´æ˜æœ‰åŠ©äºç”¨æˆ·æ›´å¥½åœ°ä½¿ç”¨æ‚¨çš„æ’ä»¶</small>
                </div>
            </div>

            <!-- æäº¤æŒ‰é’® -->
            <div class="submit-actions">
                <button type="button" class="btn-secondary" onclick="window.location.href='../toolstore.html'">å–æ¶ˆ</button>
                <button type="button" class="btn-secondary" onclick="saveDraft()">ä¿å­˜è‰ç¨¿</button>
                <button type="submit" class="btn-primary">æäº¤å®¡æ ¸</button>
            </div>
        </form>
    </div>

    <script src="../js/main.js"></script>
    <script>
        let uploadedFiles = [];
        let uploadedScreenshots = [];
        let features = [];

        // æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ
        const fileUploadArea = document.getElementById('fileUploadArea');
        const pluginFileInput = document.getElementById('pluginFile');
        const screenshotUploadArea = document.getElementById('screenshotUploadArea');
        const screenshotsInput = document.getElementById('screenshots');

        // æ’ä»¶æ–‡ä»¶ä¸Šä¼ 
        pluginFileInput.addEventListener('change', function(e) {
            handleFileUpload(e.target.files[0], 'plugin');
        });

        fileUploadArea.addEventListener('dragover', function(e) {
            e.preventDefault();
            fileUploadArea.classList.add('dragover');
        });

        fileUploadArea.addEventListener('dragleave', function(e) {
            e.preventDefault();
            fileUploadArea.classList.remove('dragover');
        });

        fileUploadArea.addEventListener('drop', function(e) {
            e.preventDefault();
            fileUploadArea.classList.remove('dragover');
            if (e.dataTransfer.files.length > 0) {
                handleFileUpload(e.dataTransfer.files[0], 'plugin');
            }
        });

        // æˆªå›¾ä¸Šä¼ 
        screenshotsInput.addEventListener('change', function(e) {
            Array.from(e.target.files).forEach(file => {
                if (uploadedScreenshots.length < 5) {
                    handleFileUpload(file, 'screenshot');
                }
            });
        });

        screenshotUploadArea.addEventListener('dragover', function(e) {
            e.preventDefault();
            screenshotUploadArea.classList.add('dragover');
        });

        screenshotUploadArea.addEventListener('dragleave', function(e) {
            e.preventDefault();
            screenshotUploadArea.classList.remove('dragover');
        });

        screenshotUploadArea.addEventListener('drop', function(e) {
            e.preventDefault();
            screenshotUploadArea.classList.remove('dragover');
            Array.from(e.dataTransfer.files).forEach(file => {
                if (uploadedScreenshots.length < 5 && file.type.startsWith('image/')) {
                    handleFileUpload(file, 'screenshot');
                }
            });
        });

        // å¤„ç†æ–‡ä»¶ä¸Šä¼ 
        function handleFileUpload(file, type) {
            if (type === 'plugin') {
                uploadedFiles = [file];
                updateFileList('fileList', uploadedFiles, 'plugin');
            } else if (type === 'screenshot') {
                if (uploadedScreenshots.length < 5) {
                    uploadedScreenshots.push(file);
                    updateFileList('screenshotList', uploadedScreenshots, 'screenshot');
                } else {
                    alert('æœ€å¤šåªèƒ½ä¸Šä¼ 5å¼ æˆªå›¾');
                }
            }
        }

        // æ›´æ–°æ–‡ä»¶åˆ—è¡¨æ˜¾ç¤º
        function updateFileList(listId, files, type) {
            const list = document.getElementById(listId);
            list.innerHTML = '';

            files.forEach((file, index) => {
                const item = document.createElement('div');
                item.className = 'file-item';
                item.innerHTML = `
                    <div class="file-item-name">${file.name} (${formatFileSize(file.size)})</div>
                    <span class="file-item-remove" onclick="removeFile(${index}, '${type}')">&times;</span>
                `;
                list.appendChild(item);
            });
        }

        // ç§»é™¤æ–‡ä»¶
        function removeFile(index, type) {
            if (type === 'plugin') {
                uploadedFiles = [];
                updateFileList('fileList', uploadedFiles, 'plugin');
            } else if (type === 'screenshot') {
                uploadedScreenshots.splice(index, 1);
                updateFileList('screenshotList', uploadedScreenshots, 'screenshot');
            }
        }
        window.removeFile = removeFile;

        // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }

        // æ·»åŠ åŠŸèƒ½ç‚¹
        function addFeature() {
            const input = document.getElementById('featureInput');
            const feature = input.value.trim();

            if (feature && features.length < 10) {
                features.push(feature);
                updateFeatureTags();
                input.value = '';
            } else if (features.length >= 10) {
                alert('æœ€å¤šåªèƒ½æ·»åŠ 10ä¸ªåŠŸèƒ½ç‚¹');
            }
        }
        window.addFeature = addFeature;

        // å›è½¦æ·»åŠ åŠŸèƒ½
        document.getElementById('featureInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                addFeature();
            }
        });

        // æ›´æ–°åŠŸèƒ½æ ‡ç­¾
        function updateFeatureTags() {
            const container = document.getElementById('featureTags');
            container.innerHTML = features.map((feature, index) => `
                <span class="feature-tag">
                    ${feature}
                    <span class="feature-tag-remove" onclick="removeFeature(${index})">&times;</span>
                </span>
            `).join('');
        }

        // ç§»é™¤åŠŸèƒ½ç‚¹
        function removeFeature(index) {
            features.splice(index, 1);
            updateFeatureTags();
        }
        window.removeFeature = removeFeature;

        // è®¾ä¸ºå…è´¹
        function setFree() {
            document.getElementById('pluginPrice').value = '0';
            document.getElementById('priceReason').value = 'æœ¬æ’ä»¶å…è´¹æä¾›ç»™æ‰€æœ‰ç”¨æˆ·ä½¿ç”¨ã€‚';
        }
        window.setFree = setFree;

        // ä¿å­˜è‰ç¨¿
        function saveDraft() {
            const formData = getFormData();
            localStorage.setItem('pluginDraft', JSON.stringify(formData));
            alert('è‰ç¨¿å·²ä¿å­˜ï¼');
        }
        window.saveDraft = saveDraft;

        // è·å–è¡¨å•æ•°æ®
        function getFormData() {
            return {
                name: document.getElementById('pluginName').value,
                category: document.getElementById('pluginCategory').value,
                version: document.getElementById('pluginVersion').value,
                description: document.getElementById('pluginDescription').value,
                features: features,
                price: parseInt(document.getElementById('pluginPrice').value) || 0,
                priceReason: document.getElementById('priceReason').value,
                usageInstructions: document.getElementById('usageInstructions').value,
                files: uploadedFiles.map(f => f.name),
                screenshots: uploadedScreenshots.map(f => f.name)
            };
        }

        // è¡¨å•æäº¤
        document.getElementById('uploadPluginForm').addEventListener('submit', function(e) {
            e.preventDefault();

            // éªŒè¯åŠŸèƒ½ç‚¹
            if (features.length < 3) {
                alert('è¯·è‡³å°‘æ·»åŠ 3ä¸ªä¸»è¦åŠŸèƒ½ç‚¹');
                return;
            }

            // éªŒè¯æ–‡ä»¶
            if (uploadedFiles.length === 0) {
                alert('è¯·ä¸Šä¼ æ’ä»¶æ–‡ä»¶');
                return;
            }

            const formData = getFormData();

            // æ¨¡æ‹Ÿæäº¤
            const submitBtn = e.target.querySelector('button[type="submit"]');
            submitBtn.textContent = 'æäº¤ä¸­...';
            submitBtn.disabled = true;

            setTimeout(() => {
                alert('âœ… æ’ä»¶æäº¤æˆåŠŸï¼\n\næ‚¨çš„æ’ä»¶å·²æäº¤å®¡æ ¸ï¼Œç®¡ç†å‘˜å°†åœ¨1-3ä¸ªå·¥ä½œæ—¥å†…å®Œæˆå®¡æ ¸ã€‚å®¡æ ¸ç»“æœå°†é€šè¿‡ç«™å†…æ¶ˆæ¯é€šçŸ¥æ‚¨ã€‚');

                // æ¸…é™¤è‰ç¨¿
                localStorage.removeItem('pluginDraft');

                // è·³è½¬åˆ°å·¥å…·å•†åº—
                window.location.href = '../toolstore.html';
            }, 1500);
        });

        // åŠ è½½è‰ç¨¿
        window.addEventListener('DOMContentLoaded', function() {
            const draft = localStorage.getItem('pluginDraft');
            if (draft) {
                if (confirm('æ£€æµ‹åˆ°æœªå®Œæˆçš„è‰ç¨¿ï¼Œæ˜¯å¦åŠ è½½ï¼Ÿ')) {
                    const data = JSON.parse(draft);
                    document.getElementById('pluginName').value = data.name || '';
                    document.getElementById('pluginCategory').value = data.category || '';
                    document.getElementById('pluginVersion').value = data.version || '';
                    document.getElementById('pluginDescription').value = data.description || '';
                    document.getElementById('pluginPrice').value = data.price || '';
                    document.getElementById('priceReason').value = data.priceReason || '';
                    document.getElementById('usageInstructions').value = data.usageInstructions || '';
                    features = data.features || [];
                    updateFeatureTags();
                }
            }
        });
    </script>
</body>
</html>

