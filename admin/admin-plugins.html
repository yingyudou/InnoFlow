<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ’ä»¶å®¡æ ¸ç®¡ç† - InnoFlow</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/layout.css">
    <link rel="stylesheet" href="../css/animation.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        .admin-nav {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .admin-nav-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        .admin-nav-title {
            font-size: 20px;
            font-weight: 600;
        }
        .admin-nav-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        .admin-badge-nav {
            background: rgba(255,255,255,0.2);
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
        }
        .admin-sidebar {
            width: 240px;
            background: #f8f9fa;
            min-height: calc(100vh - 64px);
            padding: 24px 0;
            border-right: 1px solid var(--border-color);
        }
        .admin-sidebar-item {
            padding: 12px 24px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--text-primary);
            text-decoration: none;
        }
        .admin-sidebar-item:hover {
            background: #e9ecef;
        }
        .admin-sidebar-item.active {
            background: var(--primary-color);
            color: white;
        }
        .admin-content {
            flex: 1;
            padding: 32px;
            background: #f8f9fa;
        }
        .admin-layout {
            display: flex;
        }
        .filter-tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            background: white;
            padding: 8px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .filter-tab {
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            background: transparent;
            color: var(--text-primary);
        }
        .filter-tab.active {
            background: var(--primary-color);
            color: white;
        }
        .plugin-review-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .plugin-review-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 16px;
        }
        .plugin-review-info h3 {
            margin: 0 0 8px 0;
            font-size: 20px;
        }
        .plugin-review-meta {
            display: flex;
            gap: 16px;
            font-size: 14px;
            color: var(--text-secondary);
        }
        .plugin-review-status {
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        .status-reviewing {
            background: #cfe2ff;
            color: #084298;
        }
        .status-approved {
            background: #d1e7dd;
            color: #0f5132;
        }
        .status-rejected {
            background: #f8d7da;
            color: #842029;
        }
        .plugin-review-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 16px;
        }
        .plugin-review-section {
            margin-bottom: 16px;
        }
        .plugin-review-section h4 {
            margin: 0 0 8px 0;
            font-size: 14px;
            color: var(--text-secondary);
        }
        .plugin-review-section p {
            margin: 0;
            color: var(--text-primary);
        }
        .plugin-review-actions {
            display: flex;
            gap: 12px;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border-color);
        }
        .price-display {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            margin-top: 8px;
        }
        .price-display strong {
            color: var(--primary-color);
            font-size: 18px;
        }
    </style>
</head>
<body>
    <nav class="admin-nav">
        <div class="admin-nav-left">
            <img src="../assets/logo.svg" alt="InnoFlow" style="width: 32px; height: 32px; filter: brightness(0) invert(1);">
            <span class="admin-nav-title">InnoFlow ç®¡ç†åå°</span>
            <span class="admin-badge-nav">ç®¡ç†å‘˜</span>
        </div>
        <div class="admin-nav-right">
            <span id="adminUsername">ç®¡ç†å‘˜</span>
            <button class="btn-secondary" onclick="logout()" style="background: rgba(255,255,255,0.2); color: white; border: none;">é€€å‡ºç™»å½•</button>
        </div>
    </nav>

    <div class="admin-layout">
        <div class="admin-sidebar">
            <a href="admin-dashboard.html" class="admin-sidebar-item">
                <span>ğŸ“Š</span>
                <span>ä»ªè¡¨ç›˜</span>
            </a>
            <a href="admin-plugins.html" class="admin-sidebar-item active">
                <span>ğŸ”Œ</span>
                <span>æ’ä»¶å®¡æ ¸</span>
            </a>
            <a href="admin-users.html" class="admin-sidebar-item">
                <span>ğŸ‘¥</span>
                <span>ç”¨æˆ·ç®¡ç†</span>
            </a>
            <a href="admin-finance.html" class="admin-sidebar-item">
                <span>ğŸ’³</span>
                <span>è´¢åŠ¡ç®¡ç†</span>
            </a>
            <a href="admin-settings.html" class="admin-sidebar-item">
                <span>âš™ï¸</span>
                <span>ç³»ç»Ÿè®¾ç½®</span>
            </a>
        </div>

        <div class="admin-content">
            <h1 style="margin-bottom: 24px;">æ’ä»¶å®¡æ ¸ç®¡ç†</h1>

            <!-- ç­›é€‰æ ‡ç­¾ -->
            <div class="filter-tabs">
                <button class="filter-tab active" onclick="filterPlugins('all')">å…¨éƒ¨</button>
                <button class="filter-tab" onclick="filterPlugins('pending')">å¾…å®¡æ ¸ (8)</button>
                <button class="filter-tab" onclick="filterPlugins('reviewing')">å®¡æ ¸ä¸­ (3)</button>
                <button class="filter-tab" onclick="filterPlugins('approved')">å·²é€šè¿‡ (45)</button>
                <button class="filter-tab" onclick="filterPlugins('rejected')">å·²é©³å› (5)</button>
            </div>

            <!-- æ’ä»¶åˆ—è¡¨ -->
            <div id="pluginList">
                <!-- åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <script src="../js/admin.js"></script>
    <script src="../js/pricing.js"></script>
    <script>
        // æ£€æŸ¥ç®¡ç†å‘˜ç™»å½•çŠ¶æ€
        if (!sessionStorage.getItem('adminLoggedIn')) {
            window.location.href = 'admin-login.html';
        }

        // æ˜¾ç¤ºç®¡ç†å‘˜ç”¨æˆ·å
        const adminUsername = sessionStorage.getItem('adminUsername') || 'ç®¡ç†å‘˜';
        document.getElementById('adminUsername').textContent = adminUsername;

        // é€€å‡ºç™»å½•
        function logout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                sessionStorage.removeItem('adminLoggedIn');
                sessionStorage.removeItem('adminUsername');
                window.location.href = 'admin-login.html';
            }
        }
        window.logout = logout;

        // æ’ä»¶æ•°æ®ï¼ˆæ¨¡æ‹Ÿï¼‰
        const pluginsData = [
            {
                id: 'plugin-1',
                name: 'AIä»£ç å®¡æŸ¥å·¥å…·',
                author: 'TechFlowå›¢é˜Ÿ',
                authorId: 'dev-1',
                uploadTime: '2025-11-01 14:30',
                status: 'pending',
                description: 'è‡ªåŠ¨å®¡æŸ¥ä»£ç è´¨é‡ï¼Œå‘ç°æ½œåœ¨é—®é¢˜å’Œä¼˜åŒ–å»ºè®®ï¼Œæ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€',
                category: 'å¼€å‘å·¥å…·',
                version: 'v1.0.5',
                price: 199,
                proposedPrice: 199,
                priceReason: 'åŠŸèƒ½å¼ºå¤§ï¼Œå¸‚åœºåŒç±»äº§å“ä»·æ ¼åœ¨150-250å…ƒä¹‹é—´',
                features: ['ä»£ç è´¨é‡æ£€æµ‹', 'å®‰å…¨æ¼æ´æ‰«æ', 'æ€§èƒ½ä¼˜åŒ–å»ºè®®', 'å¤šè¯­è¨€æ”¯æŒ'],
                screenshots: [],
                downloadCount: 0,
                rating: 0
            },
            {
                id: 'plugin-2',
                name: 'æ€§èƒ½ç›‘æ§æ’ä»¶',
                author: 'Metrics Lab',
                authorId: 'dev-2',
                uploadTime: '2025-11-01 10:15',
                status: 'pending',
                description: 'å®æ—¶ç›‘æ§é¡¹ç›®æ€§èƒ½æŒ‡æ ‡ï¼Œç”Ÿæˆåˆ†ææŠ¥å‘Šï¼Œå¸®åŠ©ä¼˜åŒ–é¡¹ç›®æ€§èƒ½',
                category: 'ç›‘æ§å·¥å…·',
                version: 'v1.8.3',
                price: 149,
                proposedPrice: 149,
                priceReason: 'å‚è€ƒå¸‚åœºåŒç±»äº§å“ï¼ŒåŠŸèƒ½å®Œå–„',
                features: ['å®æ—¶ç›‘æ§', 'æ€§èƒ½åˆ†æ', 'æŠ¥å‘Šç”Ÿæˆ', 'å‘Šè­¦é€šçŸ¥'],
                screenshots: [],
                downloadCount: 0,
                rating: 0
            },
            {
                id: 'plugin-3',
                name: 'APIæµ‹è¯•å·¥å…·',
                author: 'API Toolså›¢é˜Ÿ',
                authorId: 'dev-3',
                uploadTime: '2025-10-31 16:45',
                status: 'reviewing',
                description: 'å¯è§†åŒ–APIæµ‹è¯•ï¼Œè‡ªåŠ¨ç”Ÿæˆæµ‹è¯•æŠ¥å‘Šï¼Œæ”¯æŒRESTfulå’ŒGraphQL',
                category: 'æµ‹è¯•å·¥å…·',
                version: 'v1.5.0',
                price: 299,
                proposedPrice: 249,
                priceReason: 'åŠŸèƒ½å…¨é¢ï¼Œä½†ä»·æ ¼åé«˜ï¼Œå»ºè®®è°ƒæ•´',
                features: ['APIæµ‹è¯•', 'è‡ªåŠ¨åŒ–æµ‹è¯•', 'æŠ¥å‘Šç”Ÿæˆ', 'å¤šåè®®æ”¯æŒ'],
                screenshots: [],
                downloadCount: 0,
                rating: 0
            }
        ];

        // å½“å‰ç­›é€‰çŠ¶æ€
        let currentFilter = 'all';

        // ç­›é€‰æ’ä»¶
        function filterPlugins(status) {
            currentFilter = status;

            // æ›´æ–°æ ‡ç­¾çŠ¶æ€
            document.querySelectorAll('.filter-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            // æ¸²æŸ“åˆ—è¡¨
            renderPluginList();
        }
        window.filterPlugins = filterPlugins;

        // æ¸²æŸ“æ’ä»¶åˆ—è¡¨
        function renderPluginList() {
            const list = document.getElementById('pluginList');
            let filteredPlugins = pluginsData;

            if (currentFilter !== 'all') {
                filteredPlugins = pluginsData.filter(p => p.status === currentFilter);
            }

            if (filteredPlugins.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 40px;">æš‚æ— æ•°æ®</p>';
                return;
            }

            list.innerHTML = filteredPlugins.map(plugin => createPluginCard(plugin)).join('');
        }

        // åˆ›å»ºæ’ä»¶å¡ç‰‡
        function createPluginCard(plugin) {
            const statusMap = {
                pending: { text: 'å¾…å®¡æ ¸', class: 'status-pending' },
                reviewing: { text: 'å®¡æ ¸ä¸­', class: 'status-reviewing' },
                approved: { text: 'å·²é€šè¿‡', class: 'status-approved' },
                rejected: { text: 'å·²é©³å›', class: 'status-rejected' }
            };

            const status = statusMap[plugin.status] || statusMap.pending;

            return `
                <div class="plugin-review-card" data-id="${plugin.id}">
                    <div class="plugin-review-header">
                        <div class="plugin-review-info">
                            <h3>${plugin.name}</h3>
                            <div class="plugin-review-meta">
                                <span>ä¸Šä¼ è€…: ${plugin.author}</span>
                                <span>ä¸Šä¼ æ—¶é—´: ${plugin.uploadTime}</span>
                                <span>åˆ†ç±»: ${plugin.category}</span>
                                <span>ç‰ˆæœ¬: ${plugin.version}</span>
                            </div>
                        </div>
                        <span class="plugin-review-status ${status.class}">${status.text}</span>
                    </div>

                    <div class="plugin-review-content">
                        <div>
                            <div class="plugin-review-section">
                                <h4>æ’ä»¶æè¿°</h4>
                                <p>${plugin.description}</p>
                            </div>
                            <div class="plugin-review-section">
                                <h4>ä¸»è¦åŠŸèƒ½</h4>
                                <p>${plugin.features.join(' Â· ')}</p>
                            </div>
                        </div>
                        <div>
                            <div class="plugin-review-section">
                                <h4>å®šä»·ä¿¡æ¯</h4>
                                <div class="price-display">
                                    <div>ä¸Šä¼ è€…å®šä»·: <strong>Â¥${plugin.price}</strong></div>
                                    <div style="margin-top: 8px; font-size: 12px; color: var(--text-secondary);">
                                        å®šä»·ç†ç”±: ${plugin.priceReason}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="plugin-review-actions">
                        <button class="btn-primary" onclick="viewPluginDetail('${plugin.id}')">æŸ¥çœ‹è¯¦æƒ…</button>
                        ${plugin.status === 'pending' || plugin.status === 'reviewing' ? `
                            <button class="btn-primary" onclick="startPricingNegotiation('${plugin.id}')">å®šä»·åå•†</button>
                            <button class="btn-primary" style="background: #28a745;" onclick="approvePlugin('${plugin.id}')">é€šè¿‡å®¡æ ¸</button>
                            <button class="btn-secondary" style="background: #dc3545; color: white;" onclick="rejectPlugin('${plugin.id}')">é©³å›</button>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        // æŸ¥çœ‹æ’ä»¶è¯¦æƒ…
        function viewPluginDetail(pluginId) {
            const plugin = pluginsData.find(p => p.id === pluginId);
            if (!plugin) return;

            alert(`æ’ä»¶è¯¦æƒ…\n\nåç§°: ${plugin.name}\nä½œè€…: ${plugin.author}\næè¿°: ${plugin.description}\nç‰ˆæœ¬: ${plugin.version}\nå®šä»·: Â¥${plugin.price}`);
        }
        window.viewPluginDetail = viewPluginDetail;

        // å¼€å§‹å®šä»·åå•†
        function startPricingNegotiation(pluginId) {
            window.location.href = `admin-pricing.html?plugin=${pluginId}`;
        }
        window.startPricingNegotiation = startPricingNegotiation;

        // é€šè¿‡å®¡æ ¸
        function approvePlugin(pluginId) {
            if (confirm('ç¡®å®šè¦é€šè¿‡æ­¤æ’ä»¶çš„å®¡æ ¸å—ï¼Ÿ')) {
                const plugin = pluginsData.find(p => p.id === pluginId);
                if (plugin) {
                    plugin.status = 'approved';
                    renderPluginList();
                    alert('æ’ä»¶å®¡æ ¸å·²é€šè¿‡ï¼');
                }
            }
        }
        window.approvePlugin = approvePlugin;

        // é©³å›æ’ä»¶
        function rejectPlugin(pluginId) {
            const reason = prompt('è¯·è¾“å…¥é©³å›åŸå› ï¼š');
            if (reason) {
                const plugin = pluginsData.find(p => p.id === pluginId);
                if (plugin) {
                    plugin.status = 'rejected';
                    renderPluginList();
                    alert('æ’ä»¶å·²é©³å›');
                }
            }
        }
        window.rejectPlugin = rejectPlugin;

        // åˆå§‹åŒ–
        renderPluginList();
    </script>
</body>
</html>
