<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è´¢åŠ¡ç®¡ç† - InnoFlow</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/layout.css">
    <link rel="stylesheet" href="../css/animation.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        .admin-nav {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .admin-nav-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        .admin-nav-title {
            font-size: 20px;
            font-weight: 600;
        }
        .admin-nav-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        .admin-badge-nav {
            background: rgba(255,255,255,0.2);
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
        }
        .admin-sidebar {
            width: 240px;
            background: #f8f9fa;
            min-height: calc(100vh - 64px);
            padding: 24px 0;
            border-right: 1px solid var(--border-color);
        }
        .admin-sidebar-item {
            padding: 12px 24px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--text-primary);
            text-decoration: none;
        }
        .admin-sidebar-item:hover {
            background: #e9ecef;
        }
        .admin-sidebar-item.active {
            background: var(--primary-color);
            color: white;
        }
        .admin-content {
            flex: 1;
            padding: 32px;
            background: #f8f9fa;
        }
        .admin-layout {
            display: flex;
        }
        .finance-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }
        .finance-stat-card {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .finance-stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        .finance-stat-title {
            font-size: 14px;
            color: var(--text-secondary);
        }
        .finance-stat-icon {
            font-size: 32px;
        }
        .finance-stat-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 8px;
        }
        .finance-stat-change {
            font-size: 12px;
            color: var(--text-secondary);
        }
        .finance-stat-change.positive {
            color: #28a745;
        }
        .finance-stat-change.negative {
            color: #dc3545;
        }
        .transaction-table {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            overflow: hidden;
        }
        .transaction-header {
            display: grid;
            grid-template-columns: 120px 1fr 120px 120px 120px 100px;
            gap: 16px;
            padding: 16px 20px;
            background: #f8f9fa;
            font-weight: 600;
            font-size: 14px;
            color: var(--text-secondary);
            border-bottom: 2px solid var(--border-color);
        }
        .transaction-row {
            display: grid;
            grid-template-columns: 120px 1fr 120px 120px 120px 100px;
            gap: 16px;
            padding: 16px 20px;
            border-bottom: 1px solid var(--border-color);
            align-items: center;
        }
        .transaction-row:last-child {
            border-bottom: none;
        }
        .transaction-type {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-align: center;
        }
        .type-sale {
            background: #d1e7dd;
            color: #0f5132;
        }
        .type-withdrawal {
            background: #fff3cd;
            color: #856404;
        }
        .type-refund {
            background: #f8d7da;
            color: #842029;
        }
        .amount-positive {
            color: #28a745;
            font-weight: 600;
        }
        .amount-negative {
            color: #dc3545;
            font-weight: 600;
        }
        .filter-bar {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            margin-bottom: 24px;
            display: flex;
            gap: 16px;
            align-items: center;
            flex-wrap: wrap;
        }
        .filter-select {
            padding: 10px 16px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            background: white;
        }
    </style>
</head>
<body>
    <nav class="admin-nav">
        <div class="admin-nav-left">
            <img src="../assets/logo.svg" alt="InnoFlow" style="width: 32px; height: 32px; filter: brightness(0) invert(1);">
            <span class="admin-nav-title">InnoFlow ç®¡ç†åå°</span>
            <span class="admin-badge-nav">ç®¡ç†å‘˜</span>
        </div>
        <div class="admin-nav-right">
            <span id="adminUsername">ç®¡ç†å‘˜</span>
            <button class="btn-secondary" onclick="logout()" style="background: rgba(255,255,255,0.2); color: white; border: none;">é€€å‡ºç™»å½•</button>
        </div>
    </nav>

    <div class="admin-layout">
        <div class="admin-sidebar">
            <a href="admin-dashboard.html" class="admin-sidebar-item">
                <span>ğŸ“Š</span>
                <span>ä»ªè¡¨ç›˜</span>
            </a>
            <a href="admin-plugins.html" class="admin-sidebar-item">
                <span>ğŸ”Œ</span>
                <span>æ’ä»¶å®¡æ ¸</span>
            </a>
            <a href="admin-users.html" class="admin-sidebar-item">
                <span>ğŸ‘¥</span>
                <span>ç”¨æˆ·ç®¡ç†</span>
            </a>
            <a href="admin-finance.html" class="admin-sidebar-item active">
                <span>ğŸ’³</span>
                <span>è´¢åŠ¡ç®¡ç†</span>
            </a>
            <a href="admin-settings.html" class="admin-sidebar-item">
                <span>âš™ï¸</span>
                <span>ç³»ç»Ÿè®¾ç½®</span>
            </a>
        </div>

        <div class="admin-content">
            <h1 style="margin-bottom: 24px;">è´¢åŠ¡ç®¡ç†</h1>

            <!-- è´¢åŠ¡ç»Ÿè®¡ -->
            <div class="finance-stats">
                <div class="finance-stat-card">
                    <div class="finance-stat-header">
                        <div class="finance-stat-title">å¹³å°æ€»æ”¶ç›Š</div>
                        <div class="finance-stat-icon">ğŸ’°</div>
                    </div>
                    <div class="finance-stat-value">Â¥45,230</div>
                    <div class="finance-stat-change positive">è¾ƒä¸Šæœˆ +12.5%</div>
                </div>
                <div class="finance-stat-card">
                    <div class="finance-stat-header">
                        <div class="finance-stat-title">æœ¬æœˆæ”¶ç›Š</div>
                        <div class="finance-stat-icon">ğŸ“ˆ</div>
                    </div>
                    <div class="finance-stat-value">Â¥12,450</div>
                    <div class="finance-stat-change positive">è¾ƒä¸Šæœˆ +8.3%</div>
                </div>
                <div class="finance-stat-card">
                    <div class="finance-stat-header">
                        <div class="finance-stat-title">å¼€å‘è€…åˆ†æˆ</div>
                        <div class="finance-stat-icon">ğŸ’µ</div>
                    </div>
                    <div class="finance-stat-value">Â¥31,661</div>
                    <div class="finance-stat-change">å·²æ”¯ä»˜ 70%</div>
                </div>
                <div class="finance-stat-card">
                    <div class="finance-stat-header">
                        <div class="finance-stat-title">å¾…å®¡æ ¸æç°</div>
                        <div class="finance-stat-icon">â³</div>
                    </div>
                    <div class="finance-stat-value">Â¥3,200</div>
                    <div class="finance-stat-change">3 ç¬”å¾…å¤„ç†</div>
                </div>
            </div>

            <!-- ç­›é€‰æ  -->
            <div class="filter-bar">
                <select class="filter-select" id="typeFilter" onchange="filterTransactions()">
                    <option value="all">å…¨éƒ¨ç±»å‹</option>
                    <option value="sale">æ’ä»¶é”€å”®</option>
                    <option value="withdrawal">æç°</option>
                    <option value="refund">é€€æ¬¾</option>
                </select>
                <select class="filter-select" id="periodFilter" onchange="filterTransactions()">
                    <option value="all">å…¨éƒ¨æ—¶é—´</option>
                    <option value="today">ä»Šå¤©</option>
                    <option value="week">æœ¬å‘¨</option>
                    <option value="month">æœ¬æœˆ</option>
                </select>
            </div>

            <!-- äº¤æ˜“è®°å½• -->
            <div class="transaction-table">
                <div class="transaction-header">
                    <div>æ—¶é—´</div>
                    <div>äº¤æ˜“è¯¦æƒ…</div>
                    <div>ç±»å‹</div>
                    <div>å¹³å°æ”¶ç›Š</div>
                    <div>å¼€å‘è€…æ”¶ç›Š</div>
                    <div>çŠ¶æ€</div>
                </div>
                <div id="transactionList">
                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </div>

    <script src="../js/admin.js"></script>
    <script>
        if (!sessionStorage.getItem('adminLoggedIn')) {
            window.location.href = 'admin-login.html';
        }
        const adminUsername = sessionStorage.getItem('adminUsername') || 'ç®¡ç†å‘˜';
        document.getElementById('adminUsername').textContent = adminUsername;
        function logout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                sessionStorage.removeItem('adminLoggedIn');
                sessionStorage.removeItem('adminUsername');
                window.location.href = 'admin-login.html';
            }
        }
        window.logout = logout;

        // äº¤æ˜“æ•°æ®ï¼ˆæ¨¡æ‹Ÿï¼‰
        const transactionsData = [
            { id: 1, time: '2025-11-02 14:30', plugin: 'AIä»£ç å®¡æŸ¥', developer: 'TechFlowå›¢é˜Ÿ', type: 'sale', amount: 99, platformFee: 29.7, developerFee: 69.3, status: 'completed' },
            { id: 2, time: '2025-11-02 10:15', plugin: 'APIæµ‹è¯•å·¥å…·', developer: 'API Toolså›¢é˜Ÿ', type: 'sale', amount: 129, platformFee: 38.7, developerFee: 90.3, status: 'completed' },
            { id: 3, time: '2025-11-01 16:45', plugin: 'æ€§èƒ½ç›‘æ§', developer: 'Metrics Lab', type: 'sale', amount: 79, platformFee: 23.7, developerFee: 55.3, status: 'completed' },
            { id: 4, time: '2025-11-01 09:20', developer: 'TechFlowå›¢é˜Ÿ', type: 'withdrawal', amount: 500, platformFee: 0, developerFee: 500, status: 'pending' },
            { id: 5, time: '2025-10-31 15:30', plugin: 'æµ‹è¯•è‡ªåŠ¨åŒ–', developer: 'QA Pro', type: 'sale', amount: 149, platformFee: 44.7, developerFee: 104.3, status: 'completed' },
            { id: 6, time: '2025-10-30 11:20', plugin: 'AIä»£ç å®¡æŸ¥', developer: 'TechFlowå›¢é˜Ÿ', type: 'refund', amount: 99, platformFee: -29.7, developerFee: -69.3, status: 'completed' }
        ];

        // æ¸²æŸ“äº¤æ˜“åˆ—è¡¨
        function renderTransactions(transactions = transactionsData) {
            const list = document.getElementById('transactionList');
            if (transactions.length === 0) {
                list.innerHTML = '<div style="padding: 40px; text-align: center; color: var(--text-secondary);">æš‚æ— äº¤æ˜“è®°å½•</div>';
                return;
            }

            list.innerHTML = transactions.map(trans => {
                const typeMap = {
                    sale: { text: 'æ’ä»¶é”€å”®', class: 'type-sale' },
                    withdrawal: { text: 'æç°', class: 'type-withdrawal' },
                    refund: { text: 'é€€æ¬¾', class: 'type-refund' }
                };
                const statusMap = {
                    completed: 'å·²å®Œæˆ',
                    pending: 'å¾…å¤„ç†',
                    failed: 'å¤±è´¥'
                };

                const type = typeMap[trans.type] || typeMap.sale;

                return `
                    <div class="transaction-row">
                        <div style="font-size: 14px; color: var(--text-secondary);">${trans.time}</div>
                        <div>
                            <div style="font-weight: 600; color: var(--text-primary);">
                                ${trans.plugin ? `æ’ä»¶: ${trans.plugin}` : 'æç°ç”³è¯·'}
                            </div>
                            <div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">
                                å¼€å‘è€…: ${trans.developer}
                            </div>
                        </div>
                        <div>
                            <span class="transaction-type ${type.class}">${type.text}</span>
                        </div>
                        <div class="${trans.platformFee >= 0 ? 'amount-positive' : 'amount-negative'}">
                            ${trans.platformFee >= 0 ? '+' : ''}Â¥${trans.platformFee.toFixed(2)}
                        </div>
                        <div class="${trans.developerFee >= 0 ? 'amount-positive' : 'amount-negative'}">
                            ${trans.developerFee >= 0 ? '+' : ''}Â¥${trans.developerFee.toFixed(2)}
                        </div>
                        <div style="font-size: 14px; color: var(--text-secondary);">
                            ${statusMap[trans.status] || trans.status}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ç­›é€‰äº¤æ˜“
        function filterTransactions() {
            const type = document.getElementById('typeFilter').value;
            const period = document.getElementById('periodFilter').value;

            let filtered = transactionsData.filter(trans => {
                const matchType = type === 'all' || trans.type === type;
                // ç®€å•çš„æ—¶é—´ç­›é€‰ï¼ˆæ¼”ç¤ºï¼‰
                const matchPeriod = period === 'all' || true; // å®é™…åº”è¯¥æ ¹æ®æ—¶é—´ç­›é€‰
                return matchType && matchPeriod;
            });

            renderTransactions(filtered);
        }
        window.filterTransactions = filterTransactions;

        // åˆå§‹åŒ–
        renderTransactions();
    </script>
</body>
</html>
